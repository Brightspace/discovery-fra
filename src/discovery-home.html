<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="./mixins/localize-mixin.html">
<link rel="import" href="./components/search-header.html">

<link rel="import" href="../bower_components/d2l-alert/d2l-alert.html">
<link rel="import" href="../bower_components/d2l-tile/d2l-tile.html">

<dom-module id="discovery-home">
  <template>
    <style>
    </style>

    <app-route
      route="{{route}}"
      pattern="/:page"
      data="{{routeData}}">
    </app-route>

    <d2l-alert
      type="call-to-action"
      has-close-button
      button-text="Do it!"
      on-d2l-alert-button-pressed="_getInfo"
      on-d2l-alert-closed='_getInfo'>
    </d2l-alert>

    <div>
      Welcome to Discovery
      <p><a name="rootPath" href="#[[rootPath]]">Index /</a></p>
      <p><a name="other-view" href="#[[rootPath]]other-view">Other view</a></p>
      <p><a name="discovery-404" href="#[[rootPath]]discovery-404">404 View</a></p>
      <p><a name="my-new-view" href="#[[rootPath]]my-new-view">My New View</a></p>
      <p><a name="search-page" href="#[[rootPath]]search-page">Search Page</a></p>
      <p><a name="discovery-manage" href="#[[rootPath]]manage">Manage Page</a></p>

    </div>

    <h1>[[localize('hello')]]</h1>
    <div>
      <search-header query={{query}}></search-header>
    </div>
    <div>
      <h1>[[localize('recommendationHeader')]]</h1>

      <h3>[[localize('jobTitleHeader')]] [[jobTitle]]</h3>
      <div>
        <template is="dom-repeat" items="{{jobTitleCourses}}">
          <!-- <d2l-tile href="?courseId=[[item.courseId]]#[[rootPath]]discovery-course">[[item.name]]</d2l-tile><br> -->
          <!-- <d2l-tile href="#[[rootPath]]discovery-course/[[item.courseId]]">[[item.name]]</d2l-tile><br> -->
          <d2l-tile on-click="_goToCourse">[[item.name]]</d2l-tile>
        </template>
      </div>

      <h3>[[localize('listHeader')]]</h3>
      <div>
        <template is="dom-repeat" items="{{listCourses}}">
          <d2l-tile href="#[[rootPath]]discovery-course/something in spaces">[[item]]</d2l-tile><br>
        </template>
      </div>

      <h3>[[localize('departmentHeader')]] [[department]]</h3>
      <div>
        <template is="dom-repeat" items="{{departmentCourses}}">
          <d2l-tile href="#[[rootPath]]discovery-course">[[item]]</d2l-tile><br>
        </template>
      </div>

      <h3>[[localize('locationHeader')]] [[location]]</h3>
      <div>
        <template is="dom-repeat" items="{{locationCourses}}">
          <d2l-tile href="#[[rootPath]]discovery-course">[[item]]</d2l-tile><br>
        </template>
      </div>
    </div>

  </template>

  <script>
    // const supportsCustomElementsV1 = 'customElements' in window;
    // console.log('supportsCustomElementsV1:', supportsCustomElementsV1);
    class DiscoveryHome extends D2L.Discovery.LocalizeMixin(Polymer.Element) {
      constructor() {
        super();
        this.jobTitle = 'job title';
        this.department = 'department';
        this.location = 'location';

        this.jobTitleCourses = [
          { name: 'jobTitleCourseA', courseId: 123 },
          { name: 'jobTitleCourseB', courseId: 124 },
        ];
        this.listCourses = ['listCourseA', 'listCourseB'];
        this.departmentCourses = ['departmentCourseA', 'departmentCourseB'];
        this.locationCourses = ['locationCourseA', 'locationCoruseB'];
      }

      static get is() {
        return 'discovery-home';
      }

      static get properties() {
        return {
          route: Object,
          routeData: Object,
          subroute: Object,

          jobTitle: String,
          department: String,
          location: String,

          jobTitleCourses: Array,
          listCourses: Array,
          departmentCourses: Array,
          locationCourses: Array,

          page: String,
        };
      }

      _getInfo() {
        console.log('> discovery-home; route:', this.route);
        console.log('> discovery-home; rootPath:', this.rootPath);
        console.log('> discovery-home; routeData:', this.routeData);
        console.log('> discovery-home; subroute:', this.subroute);

        console.log('fire goTodiscovery-manage event');
        this.dispatchEvent(new CustomEvent('goTodiscovery-manage', {
          detail: {
          },
          bubbles: true,
          composed: true,
        }));
      }

      _goToCourse() {
        this.dispatchEvent(new CustomEvent('navigate', {
          detail: {
            path: '/d2l/le/discovery/view/course/123'
          },
          bubbles: true,
          composed: true,
        }));
      }
    }

    window.customElements.define(DiscoveryHome.is, DiscoveryHome);
    window.customElements.whenDefined(DiscoveryHome.is).then(() => {
      console.log(`${DiscoveryHome.is} is ready`);
      console.log('> discovery-home; page:', this.page);
    });
  </script>
</dom-module>
