<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../mixins/localize-mixin.html">

<link rel="import" href="../../bower_components/d2l-link/d2l-link.html">
<link rel="import" href="../../bower_components/d2l-icons/d2l-icon.html">
<link rel="import" href="../../bower_components/d2l-icons/tier2-icons.html">
<link rel="import" href="../../bower_components/d2l-search/d2l-search-input.html">

<link rel="import" href="../styles/discovery-styles.html">


<dom-module id="search-header">
  <template>
    <style include="discovery-styles"></style>
    <style>
      :host {
        display: inline;
      }

      .searchBar {
        padding-left: 1%;
        width: 50%;
      }

      .container {
        overflow: hidden;
        background-color: white;
        display: flex;
        flex-direction: row;
        flex-wrap: nowrap;
        justify-content: space-evenly;
        align-items: center;
        /* font-size: rem; */
      }

      .container d2l-icon {
        align-self: auto;
      }

      .child {
        flex-shrink: 0;
      }

      .test1 {
        box-shadow: 0 1px 5px rgba(86,86,86,0.2);
      }
    </style>

    <div class="d2l-typography test1">
      <div class="container">
        <h2 class="d2l-heading-2">
          <d2l-link href="javascript:void(0)" on-click="_navigateToHome">[[localize('discover')]]</d2l-link>
        </h2>
        <d2l-icon icon="d2l-tier2:divider-big"></d2l-icon>
        <h3 class="d2l-heading-3">[[localize('searchLabel')]]</h3>
        <d2l-search-input class="searchBar"
          label="Search"
          value="{{query}}" 
          placeholder="[[localize('searchPlaceholder')]]"
        >
        </d2l-search-input>
        <div class="child"><h3 class="d2l-heading-3">
          <d2l-link href="javascript:void(0)" on-click="_navigateToMyList">[[localize('myList')]]</d2l-link>
        </h3></div>
      </div>
    </div>
  </template>

  <script>
    class SearchHeader extends
      D2L.Discovery.LocalizeMixin(
      D2L.Discovery.RouteLocationsMixin(Polymer.Element)) {

      constructor() {
        super();
        this.query = "";
      }

      static get is() { return 'search-header'; }

      static get properties() {
        return {
          query: {
            type: String,
            notify: true,
            observer: '_queryChanged',
          },

          queryParams: {
            type: Object,
            notify: true,
          },

        };
      }

      ready() {
        super.ready();
      }

      _navigateToHome(e) {
        this.dispatchEvent(new CustomEvent('navigate', {
          detail: {
            // path: this.routeLocations().navLink(),
            path: this.routeLocations().home(),
            // path: this.routeLocations().course(123),
          },
          bubbles: true,
          composed: true,
        }));
      }

      _navigateToMyList(e) {
        console.log('navigate to mylist');
        this.dispatchEvent(new CustomEvent('navigate', {
          detail: {
            path: this.routeLocations().myList(),
          },
          bubbles: true,
          composed: true,
        }));
      }

      _queryChanged(query) {
        console.log(`>>new query: ${query}`);

        if (query) {
          this.dispatchEvent(new CustomEvent('navigate', {
            detail: {
              path: this.routeLocations().search(query.trim(), this.queryParams),
            },
            bubbles: true,
            composed: true,
          }));
        }
      }
    }

    window.customElements.define(SearchHeader.is, SearchHeader);
  </script>
</dom-module>
